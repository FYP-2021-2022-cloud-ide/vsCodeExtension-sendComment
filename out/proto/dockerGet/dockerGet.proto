syntax = "proto3";

option java_package = "ex.dockerGet";
option objc_class_prefix = "HSW";
option go_package = "github.com/proto/dockerGet";
option java_multiple_files = true;
option java_outer_classname = "docker";

package dockerGet;


service Docker {
  rpc login(LoginRequest)returns ( ListReply) {}
  rpc checkHaveContainer(CheckHaveContainerRequest)returns( SuccessStringReply ){}
  rpc listContainers(SubRequest)returns( ListContainerReply ){}
  rpc listCourses(SubRequest)returns( ListCoursesReply ){}

  rpc getSectionInfo(SectionAndSubRequest)returns(GetSectionInfoReply){}

  rpc listEnvironments(SectionAndSubRequest)returns(ListEnvironmentsReply){}
  rpc listTemplates(SectionAndSubRequest)returns(ListTemplatesReply){}

  rpc addContainer(AddContainerRequest)returns(AddContainerReply){}
  rpc instantAddContainer(InstantAddContainerRequest)returns(AddContainerReply){}
  rpc removeContainer(RemoveContainerRequest)returns(SuccessStringReply){} 
  rpc submitFiles(SubmitFilesRequest)returns(SuccessStringReply){} 
  rpc getContainerTime(RemoveContainerRequest)returns(ContainerTimeReply){} 

  rpc addTemplate(AddTemplateRequest)returns(AddTemplateReply){}
  rpc updateTemplate(UpdateTemplateRequest)returns(SuccessStringReply){}
  rpc activateTemplate(TemplateIdRequest)returns(SuccessStringReply){}
  rpc deactivateTemplate(TemplateIdRequest)returns(SuccessStringReply){}
  rpc removeTemplate(TemplateIdRequest)returns(SuccessStringReply){}

  rpc addEnvironment(AddEnvironmentRequest)returns(AddEnvironmentReply){}
  rpc updateEnvironment(UpdateEnvironmentRequest)returns(SuccessStringReply){}
  rpc buildEnvironment(BuildEnvironmentRequest)returns(AddEnvironmentReply){}
  rpc removeEnvironment(EnvironmentIdRequest)returns(SuccessStringReply){}

  rpc getUserData(SubRequest)returns(GetUserDataReply){}
  rpc updateUserData(UpdateUserDataRequest)returns(SuccessStringReply){}

  rpc getNotificationToken(SubRequest)returns(GetNotificationTokenReply){}
  rpc sendNotification(SendNotificationRequest)returns(SendNotificationReply){}
  rpc listNotifications(UserIdRequest)returns(ListNotificationsReply){}
  rpc removeNotification(RemoveNotificationRequest)returns(SuccessStringReply){}
  rpc updateNotificationToken(UpdateNotificationTokenRequest)returns(SuccessStringReply){}
  rpc updateSubscription(UpdateSubscriptionRequest)returns(SuccessStringReply){}

  rpc listFolders(UserIdRequest)returns(ListFolderReply){}
  rpc makeFolder(PathRequest)returns(SuccessStringReply){}
  rpc downloadFile(DownloadRequest)returns(stream DownloadReply){}
  rpc uploadFile(stream UploadRequest)returns(UploadReply){}
  rpc removeFile(PathRequest)returns(SuccessStringReply){}
  rpc moveFile(MoveFileRequest)returns(SuccessStringReply){}

  rpc googleOAuth(EmptyRequest)returns(SuccessStringReply){}
  rpc requestAccessToken(CodeRequest)returns(SuccessStringReply){}
  rpc googleListFile(ListFilesRequest)returns(ChildrenReply){}
}

message ListFilesRequest{
  string sub = 1;
  string folderId = 2;
}

message ChildrenReply{
  message child{
    string id = 1;
    string name = 2;
  }
  repeated child files = 1;
  repeated child folders = 2;
  bool success = 3;
  string message = 4;
}

message CodeRequest{
  string code = 1;
  string sub = 2;
}

message UserIdRequest {
  string userId = 1;
}

message ListNotificationsReply {
  bool success = 1;
  string message = 2;
  message Notification{
    string id = 1;
    string title = 2;
    string body = 3;
    message Sender{
      string id = 1;
      string sub = 2;
      string name = 3;
    }
    Sender sender = 4;
    bool allow_reply=6;
    string updated_at = 5;
  }
  repeated Notification notifications = 3;
}

message LoginRequest {
  string sub = 1;
  string name = 2;
}

message EmptyRequest {
}

message ListContainerReply{
  bool success=1;
  string message = 4;
 	message ContainersInfo{
    int64 containersAlive =1;
    int64 containersTotal=2;
  }
  ContainersInfo containerInfo=2;

  message Container {
    string courseTitle =1;
    string assignmentName   =2;
    string existedTime  =3; 
    string containerID   =4;
  }
	repeated Container containers=3;
  repeated Container tempContainers=5;
}

message ListCoursesReply {
	bool success = 1;
  string message = 2;
  message Course {
    string sectionID = 1;
    string courseCode = 2;
    string section = 3;
    string name = 4;
    string sectionRole = 5;
    string lastUpdateTime =6;
  }
	repeated Course courses =3;
}

message GetSectionInfoReply{
  bool success = 1;
  string message = 2;
  string sectionUserID=3;
  string courseName=4;
  string role=5;
}

message ListEnvironmentsReply{
  bool success=1;
  string message = 4;
  message Environment {
    string id =1;
    string imageId   =2;
    string environmentName  =3; 
    string libraries = 5;
    string description   =4;
  }
	repeated Environment environments=3;
}

message ListTemplatesReply{
  bool success=1;
  string message = 4;
  message Template {
    string id =1;
    string name   =2;
    string description=7;
    string imageId  =3; 
    string assignment_config_id   =4;
    string storage=5;
    bool active=8;
    bool is_exam=10;
    int64 time_limit=9;
    bool allow_notification=11;
    repeated string ContainerId=6; 
  }
	repeated Template templates=3;
}

message AddContainerRequest{
  string imageName =1;
  float memLimit =2;
  float numCPU=3;
  string section_user_id=4;  
  string template_id=5;
  bool dbStored =6;
  string accessRight= 7;
  bool useFresh=8;
}

message InstantAddContainerRequest {
  string sub=1;  
  string template_id=2;
}

message AddContainerReply {
	bool success=1;
	string message=2;
	string containerID=3;
}
message RemoveContainerRequest {
  string containerID=1;
}
message SubmitFilesRequest{
  string containerID=2;
  string section_user_id = 4;
}
message ContainerTimeReply{
  bool success=1;
	string message=2;
  bool is_exam=3;
  string time_limit=4;
  string created_at=5;
}


message AddTemplateRequest{
 // string imageID =1;
  string name = 2;
  string description=6;
  string containerID =5;
  string assignment_config_id = 3;
  string section_user_id = 4;
  bool active=7;
  bool is_exam=8;
  int64 time_limit=9;
  bool allow_notification=10;
}
message UpdateTemplateRequest{
   string templateID =1;
   string name = 2;
   string description=6;
   string containerID =5;
   string assignment_config_id = 3;
   string section_user_id = 4;
   bool active=7;
   bool is_exam=8;
   int64 time_limit=9;
   bool allow_notification=10;
 }
message TemplateIdRequest{
  string templateID=1;
  string section_user_id = 4;
}

message AddTemplateReply {
	bool success=1;
	string message=2;
	string templateID=3;
}




message AddEnvironmentRequest{
  repeated string libraries =1;
  string section_user_id = 2;
  string name = 3;
  string description=4;
}
message AddEnvironmentReply {
	bool success=1;
	string message=2;
	string environmentID=3;
}

message BuildEnvironmentRequest{
  string name = 2;
  string description=1;
  string section_user_id = 4;
  string containerID =5;
}

message UpdateEnvironmentRequest{
  string environmentID =1;
  string name = 2;
  string description=3;
  string section_user_id = 4;
  string containerID =5;
}

message EnvironmentIdRequest {
  string environmentID=1;
  string section_user_id = 4;
}

message SectionAndSubRequest{
  string sectionID = 1;
  string sub = 2;
}

message CheckHaveContainerRequest {
  string section_user_id = 1; 
  string containerID = 3;
}

message SubRequest {
  string sub = 1; 
}

message SectionRequest{
  string sectionID = 1; 
}

message SuccessStringReply{
  bool success=1;
	string message=2;
}

message StringReply {
  string message = 1;
}

message ListReply {
  repeated string message = 1;
}

message GetUserDataReply{
  bool success = 1;
  string message = 2;
  string userId = 3;
  string role=7;
  string semesterId = 4;
  bool darkMode =5;
  string bio =6;
}
message UpdateUserDataRequest{
  string sub=1;
  bool darkMode =5;
  string bio=6;
}

message GetNotificationTokenReply{
  bool success = 1;
  string message = 2;
  string notification_token = 3;
}

message SendNotificationRequest{
  string title=1;
  string body=2;
  string sender=3;
  string receiver=5;
  bool allow_reply=4;
}
message SendNotificationReply{
  bool success=1;
  string message =2;
  string notification_Id=3;
}

message UpdateNotificationTokenRequest{
  string sub = 1;
  string token = 2;
}

message RemoveNotificationRequest{
  string userId = 1;
  string notificationId = 2;
}

message UpdateSubscriptionRequest{
  string userId = 1;
  string token = 2;
  string semesterId = 3;
}

message ListFolderReply{
  bool success=1;
  string message=2;
  Folder root =3;
}
message Folder{
  string name=1;
  repeated Folder children=2;
  message Files {
    string name=1;
    string path =2;
  }
  repeated Files files =3;

}



message DownloadRequest {
  string filePath = 1;
  string userId = 2;
}

message DownloadReply {
  bool success=1;
  string message=2;
  bytes content=3;
}

message UploadRequest {
  oneof data{
      bytes content=2;
      UploadMetadata metaData=1;
  }
  message UploadMetadata{
    string filePath=1;
    string userId = 2;
  }
}

message UploadReply {
  bool success=1;
  string message=2;
  int64 size =3;
}

message PathRequest{
  string path = 1;
  string userId = 2;
}

message MoveFileRequest{
  string source = 1;
  string target = 2;
  string userId = 3;
}